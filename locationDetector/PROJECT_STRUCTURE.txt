Indoor Localization Metadata Extraction Service
===============================================

Project Structure
-----------------

nexhacks-winners/
â”‚
â”œâ”€â”€ src/                                   # Core application code
â”‚   â”œâ”€â”€ __init__.py                       # Package initialization
â”‚   â”œâ”€â”€ api.py                            # FastAPI REST endpoints
â”‚   â”œâ”€â”€ metadata_extractor.py             # Orchestration & error handling
â”‚   â”œâ”€â”€ overshoot_client.py               # Overshoot API client + prompt
â”‚   â”œâ”€â”€ models.py                         # Pydantic data models
â”‚   â””â”€â”€ config.py                         # Configuration management
â”‚
â”œâ”€â”€ docs/                                  # Documentation
â”‚   â”œâ”€â”€ PROJECT_OVERVIEW.md               # Architecture & design principles
â”‚   â”œâ”€â”€ FAILURE_CASES.md                  # Edge case handling analysis
â”‚   â””â”€â”€ PROMPT_ENGINEERING.md             # Prompt design explained
â”‚
â”œâ”€â”€ examples/                              # Example clients
â”‚   â”œâ”€â”€ test_client.py                    # Python CLI test client
â”‚   â””â”€â”€ react_native_example.tsx          # React Native integration
â”‚
â”œâ”€â”€ README.md                              # Comprehensive documentation
â”œâ”€â”€ QUICKSTART.md                          # 5-minute getting started guide
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md              # This implementation overview
â”œâ”€â”€ PROJECT_STRUCTURE.txt                  # This file
â”‚
â”œâ”€â”€ requirements.txt                       # Python dependencies
â”œâ”€â”€ .env.example                          # Environment variable template
â”œâ”€â”€ .gitignore                            # Git ignore rules
â””â”€â”€ run_server.sh                         # Automated server startup


File Purposes
-------------

Core Application Files:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ api.py (194 lines)                                                   â”‚
â”‚ â€¢ FastAPI application initialization                                 â”‚
â”‚ â€¢ POST /extract - single frame processing                            â”‚
â”‚ â€¢ POST /extract/batch - multiple frame processing                    â”‚
â”‚ â€¢ GET /health - health check                                         â”‚
â”‚ â€¢ GET /schema - JSON schema                                          â”‚
â”‚ â€¢ CORS configuration for mobile apps                                 â”‚
â”‚ â€¢ Global exception handling                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ metadata_extractor.py (240 lines)                                    â”‚
â”‚ â€¢ MetadataExtractionService class                                    â”‚
â”‚ â€¢ process_frame() - main extraction method                           â”‚
â”‚ â€¢ Retry logic with exponential backoff (3x)                          â”‚
â”‚ â€¢ Validation error recovery                                          â”‚
â”‚ â€¢ Confidence filtering                                               â”‚
â”‚ â€¢ Fallback data generation                                           â”‚
â”‚ â€¢ Batch processing support                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ overshoot_client.py (189 lines)                                      â”‚
â”‚ â€¢ OvershootVisionClient class                                        â”‚
â”‚ â€¢ EXTRACTION_PROMPT - carefully engineered prompt â­                 â”‚
â”‚ â€¢ extract_metadata() - API call method                               â”‚
â”‚ â€¢ Image compression (1024px, JPEG 85%)                               â”‚
â”‚ â€¢ Base64 encoding                                                    â”‚
â”‚ â€¢ HTTP client configuration                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ models.py (87 lines)                                                 â”‚
â”‚ â€¢ IndoorMetadata - main output schema                                â”‚
â”‚ â€¢ TextDetection - detected text with confidence                      â”‚
â”‚ â€¢ Landmark - physical feature with spatial context                   â”‚
â”‚ â€¢ Pydantic validation rules                                          â”‚
â”‚ â€¢ Field constraints and examples                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ config.py (35 lines)                                                 â”‚
â”‚ â€¢ Settings class with Pydantic                                       â”‚
â”‚ â€¢ Environment variable loading                                       â”‚
â”‚ â€¢ Configuration defaults                                             â”‚
â”‚ â€¢ Cached settings instance                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Data Flow
---------

1. Phone captures frame (JPEG, ~500KB)
   â”‚
   â–¼
2. POST /extract (api.py)
   â€¢ Validates file type and size
   â€¢ Reads image bytes
   â”‚
   â–¼
3. MetadataExtractionService.process_frame()
   â€¢ Orchestrates extraction
   â€¢ Handles retries on failure
   â”‚
   â–¼
4. OvershootVisionClient.extract_metadata()
   â€¢ Compresses image (~150KB)
   â€¢ Encodes as base64
   â€¢ Combines with EXTRACTION_PROMPT
   â€¢ Sends to Overshoot API
   â”‚
   â–¼
5. Overshoot Vision API
   â€¢ Processes image + prompt
   â€¢ Returns JSON observations
   â”‚
   â–¼
6. Validation (models.py)
   â€¢ Parses into IndoorMetadata
   â€¢ Validates all fields
   â€¢ Fixes common errors
   â”‚
   â–¼
7. Confidence Filtering
   â€¢ Removes low-confidence items
   â€¢ Based on CONFIDENCE_THRESHOLD
   â”‚
   â–¼
8. JSON Response
   â€¢ Returns IndoorMetadata to client
   â€¢ Always valid JSON (even on failures)


Key Design Patterns
-------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Graceful Degradation Pattern                                    â”‚
â”‚                                                                  â”‚
â”‚ Traditional:  Good Frame â†’ Data                                 â”‚
â”‚               Bad Frame  â†’ Error (âŒ)                            â”‚
â”‚                                                                  â”‚
â”‚ This System:  Good Frame â†’ High Confidence Data                 â”‚
â”‚               Bad Frame  â†’ Low Confidence Data + Flags (âœ“)      â”‚
â”‚                                                                  â”‚
â”‚ Benefits: No lost frames, partial data is useful                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Separation of Concerns                                           â”‚
â”‚                                                                  â”‚
â”‚ This Service:      What does camera see?                        â”‚
â”‚ Downstream System: Where is the user?                           â”‚
â”‚                                                                  â”‚
â”‚ Prevents: Hallucination of location from visual cues            â”‚
â”‚ Enables: Modular architecture, testability                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retry with Exponential Backoff                                  â”‚
â”‚                                                                  â”‚
â”‚ Attempt 1: Immediate                                            â”‚
â”‚ Attempt 2: Wait 1 second                                        â”‚
â”‚ Attempt 3: Wait 2 seconds                                       â”‚
â”‚ Attempt 4: Wait 4 seconds                                       â”‚
â”‚ Finally:   Return fallback data                                 â”‚
â”‚                                                                  â”‚
â”‚ Handles: Network glitches, API rate limits, transient errors    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Configuration
-------------

Environment Variables (.env):

Required:
  OVERSHOOT_API_KEY              Your Overshoot Vision API key

Optional (with defaults):
  OVERSHOOT_API_URL              API endpoint URL
  OVERSHOOT_TIMEOUT=30           Request timeout (seconds)

  API_HOST=0.0.0.0              Server bind address
  API_PORT=8000                  Server port
  API_DEBUG=false                Debug mode

  MAX_IMAGE_SIZE_MB=10           Max upload size
  CONFIDENCE_THRESHOLD=0.5       Min confidence to include
  ENABLE_CACHING=true            Enable response caching

  MAX_RETRIES=3                  Retry attempts
  RETRY_DELAY=1.0                Initial retry delay (seconds)


Quick Commands
--------------

Setup:
  pip install -r requirements.txt
  cp .env.example .env
  # Edit .env and add OVERSHOOT_API_KEY

Run Server:
  ./run_server.sh
  # or: python -m src.api

Test:
  curl -X POST "http://localhost:8000/extract" \
    -F "file=@image.jpg" | jq .

  python examples/test_client.py image.jpg

Health Check:
  curl http://localhost:8000/health

API Docs (auto-generated):
  Open http://localhost:8000/docs in browser


Documentation Quick Reference
------------------------------

Getting Started:
  QUICKSTART.md              5-minute setup guide
  README.md                  Comprehensive documentation

Understanding the System:
  IMPLEMENTATION_SUMMARY.md  Overview of what was built
  PROJECT_OVERVIEW.md        Architecture and design

Technical Deep Dives:
  FAILURE_CASES.md           How edge cases are handled
  PROMPT_ENGINEERING.md      Why the prompt works

Code Examples:
  examples/test_client.py         Python client
  examples/react_native_example.tsx   Mobile integration


API Endpoints
-------------

POST /extract
  Description:  Process single camera frame
  Input:        multipart/form-data with 'file' field
  Output:       IndoorMetadata JSON
  Example:      curl -X POST http://localhost:8000/extract \
                  -F "file=@image.jpg"

POST /extract/batch
  Description:  Process multiple frames (up to 50)
  Input:        multipart/form-data with 'files' field (multiple)
  Output:       Array of IndoorMetadata JSON
  Example:      curl -X POST http://localhost:8000/extract/batch \
                  -F "files=@img1.jpg" -F "files=@img2.jpg"

GET /health
  Description:  Health check endpoint
  Output:       {"status": "healthy", "service": "...", "version": "..."}
  Example:      curl http://localhost:8000/health

GET /schema
  Description:  Get JSON schema for IndoorMetadata
  Output:       JSON Schema object
  Example:      curl http://localhost:8000/schema


Output Schema (IndoorMetadata)
-------------------------------

{
  "scene_type": "hallway" | "room" | "lobby" | "stairwell" |
                "elevator_area" | "corridor_intersection" |
                "entrance" | "unknown",

  "scene_confidence": 0.0 - 1.0,

  "text_detected": [
    {
      "text": "Room 312",
      "confidence": 0.0 - 1.0
    }
  ],

  "landmarks": [
    {
      "type": "door" | "staircase" | "elevator" | "exit_sign" | ...,
      "direction": "left" | "right" | "ahead" | "behind",
      "distance": "near" | "mid" | "far",
      "confidence": 0.0 - 1.0,
      "additional_info": "optional context string"
    }
  ],

  "lighting_quality": "good" | "dim" | "poor" | "backlit",
  "motion_blur_detected": true | false,
  "frame_quality_score": 0.0 - 1.0,
  "processing_notes": "optional diagnostic message"
}


Development Workflow
--------------------

1. Make changes to code
2. Restart server (Ctrl+C, then ./run_server.sh)
3. Test with: python examples/test_client.py image.jpg
4. Check logs (structured JSON output)
5. Iterate

For rapid testing:
  - Use API_DEBUG=true in .env for detailed logging
  - Use low CONFIDENCE_THRESHOLD to see all detections
  - Test with variety of images (good, blurry, dark, etc.)


Testing Checklist
-----------------

â–¡ Health check responds:
  curl http://localhost:8000/health

â–¡ Single frame processing:
  python examples/test_client.py good_image.jpg

â–¡ Motion blur handling:
  python examples/test_client.py blurry_image.jpg
  # Should return data with motion_blur_detected=true

â–¡ Poor lighting handling:
  python examples/test_client.py dark_image.jpg
  # Should return data with lighting_quality="poor"

â–¡ Featureless scene:
  python examples/test_client.py blank_wall.jpg
  # Should return valid JSON with empty arrays

â–¡ Batch processing:
  curl -X POST http://localhost:8000/extract/batch \
    -F "files=@img1.jpg" -F "files=@img2.jpg"


Deployment Checklist
--------------------

â–¡ Set production OVERSHOOT_API_KEY in environment
â–¡ Set API_DEBUG=false
â–¡ Configure CORS with specific origins (not "*")
â–¡ Set MAX_IMAGE_SIZE_MB appropriately
â–¡ Add rate limiting middleware
â–¡ Set up monitoring/logging aggregation
â–¡ Configure load balancer if scaling horizontally
â–¡ Set up health check monitoring
â–¡ Test with production-like images
â–¡ Document API endpoint for clients


Common Issues & Solutions
-------------------------

Issue: "Extraction service not initialized"
Solution: Check .env file exists with valid OVERSHOOT_API_KEY

Issue: "Connection refused"
Solution: Verify server is running on correct port (lsof -i :8000)

Issue: Empty landmarks/text arrays
Solution: Normal for featureless scenes; check processing_notes

Issue: All confidence scores are low
Solution: Check image quality; review frame_quality_score

Issue: JSON parsing error
Solution: Server logs will show validation errors; check image format


Project Statistics
------------------

Core Code:           ~750 lines Python
Documentation:       ~3,500 lines Markdown
Total Files:         17 (5 core, 5 docs, 2 examples, 5 config)
API Endpoints:       4 (extract, batch, health, schema)
Dependencies:        10 Python packages
Estimated Latency:   1-3 seconds per frame
Memory per Worker:   ~50MB
Supported Formats:   JPEG, PNG
Max Image Size:      10MB (configurable)


Credits
-------

Built for: NexHacks Indoor Localization Project
Framework: FastAPI (Python)
AI Service: Overshoot Vision API
Documentation: Comprehensive guides and examples included
License: [Your License]


Next Steps
----------

1. âœ“ Implementation complete
2. â†’ Configure Overshoot API key
3. â†’ Run server and test with images
4. â†’ Integrate with mobile app
5. â†’ Build floor plan matching logic
6. â†’ Combine with IMU/WiFi data
7. â†’ Test in real building
8. â†’ Demo at hackathon!

Good luck! ğŸš€
